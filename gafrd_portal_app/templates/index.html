<!DOCTYPE html>
<html>
<head>
    <title>الرئيسية</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/jquery-ui.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'css/font-awesome.min.css' %}">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
          integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
          crossorigin=""/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
            crossorigin=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
	<script src="https://unpkg.com/shp-write@latest/shpwrite.js"></script>
	{% load static %}
	<script src="{% static 'js/shpwrite.js' %}"></script>
	<script src="{% static 'js/leaflet.geometryutil.js' %}"></script>
	<script src="{% static 'js/chart.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/jquery.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/jquery-1.9.1.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/jquery-ui.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/jquery.ui.touch-punch.min.js' %}"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.9/jquery-ui.js" type="text/javascript"></script>
    <link href="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.8.9/themes/blitzer/jquery-ui.css" rel="stylesheet" type="text/css" />
</head>
<body>

<div class="header">
    <div class="row">
        {% load static %}
        <img class="col_header1" src="{% static 'img/h_img1.png' %}">
        <img class="col_header2" src="{% static 'img/h_img2.png' %}">
        <div class="col_header3">
            <p>جمهورية مصر العربية</p>
            <p>الهيئة العامة لتنمية الثروة السمكية</p>
        </div>
        <img class="col_header4" src="{% static 'img/h_img3.png' %}">
    </div>
</div>

<div class="row main">
    <div class="leftcolumn">
        <div class="card card-menu">
            <div class="row-menu">
                <a href="{% url 'login' %}">
                    <div class="col-menu col-menu-all">تسجيل الدخول</div>
                </a>
                <a href="{% url 'contactus' %}">
                    <div class="col-menu col-menu-all">اتصل بنا</div>
                </a>
                <a href="{% url 'services' %}">
                    <div class="col-menu col-menu-all">خدماتنا</div>
                </a>
                <a href="{% url 'elibrary' %}">
                    <div class="col-menu col-menu-all">المكتبة الإلكترونية</div>
                </a>
                <a href="{% url 'index' %}">
                    <div class="col-menu col-menu-last">الرئيسية</div>
                </a>
            </div>
        </div>
        <div class="card card-map">
            <div id="mapid" style="position: relative; height:100%; width:100%; z-index:1000"></div>
            <div id="toolbar"
                 style="position: relative; left: 5px; bottom: 1px; top: -40px;  z-index:2000; border: 1px solid black; width:250px; height: 35px; display: block; ">
                <div style="border-right: 1px solid black; width: 35px; float: left; height: 100%; cursor: pointer;"><a
                        onclick='showHand()'><img src="{% static 'img/hand.png' %}" width="31px"/></a></div>
                <div style="border-right: 1px solid black; width: 35px; float: left; height: 100%; cursor: pointer;"><a
                        onclick='zoomToExtent()'><img src="{% static 'img/lookup.png' %}" width="31px"/></a></div>
                <div style="border-right: 1px solid black; width: 35px; float: left; height: 100%; cursor: pointer;"><a
                        onclick='zoomOutDraw()'><img src="{% static 'img/zoomout.png' %}" width="33px"/></a></div>
                <div style="border-right: 1px solid black; width: 35px; float: left; height: 100%; cursor: pointer;"><a
                        onclick='zoomInDraw()'><img src="{% static 'img/zoomin.png' %}" width="31px"/></a></div>
                <div style="border-right: 1px solid black; width: 35px; float: left; height: 100%; cursor: pointer;"><a
                        onclick='zoomOut()'><img src="{% static 'img/initialextent.png' %}" width="34px"/></a></div>
                <div style="border-right: 1px solid black; width: 35px; float: left; height: 100%; cursor: pointer;"><a
                        onclick='zoomIn()'><img src="{% static 'img/fullextent.png' %}" width="31px"/></a></div>
                <div style="width: 35px; float: left; height: 100%; cursor: pointer;"><a onclick='edit()'><img
                        src="{% static 'img/draw.png' %}" width="38px"/></a>
                    <div leaflet style="height: 0px;" [leafletOptions]="options">
                        <div *ngIf="shown" leafletDraw [leafletDrawOptions]="drawOptions"></div>
                    </div>
                </div>
            </div>
            <div id="legend_div" style="position: relative; float: right; bottom: 100px; right: 20px; z-index:2000; width:210px; height: 25px; display: block; ">
                <img id="legend_img_src" src="" alt="" width="200px;"/>
            </div>
            <div id="legend_min_max_div" style="color: white; position: relative; float: right; bottom: 140px; right: -180px; z-index:2000; width:200px; display: block;">
            </div>
        </div>
    </div>
    <div class="rightcolumn">
        <div class="card card-search">
            <button class="search-icon" type="submit"><i></i></button>
            <input type="text" placeholder="ابحث بكلمة|ابحث عن الفرص" name="search">
            <button class="search-button">البحث</button>
        </div>
        <div class="card card-adv-search">
            <div class="fast-search"><a href="#" class="fast-search-link">بحث سريع</a></div>
            <div class="reset">
                <button class="search-icon" type="submit"><i></i></button>
                <span class="search-span">بحث متقدم</span>
                <a href="#" class="fast-search-link">إعادة ضبط</a>
            </div>
        </div>
        <div id="parameters_div" class="card card-toc">
            <table dir="rtl">
                <tr>
                    <select class='select-dropdown'>
                        <option value="-1">تحديد المكان</option>
                        <option value="1">إدخال من الخريطة</option>
                        <option value="2">تحميل shapefile</option>
                    </select>
                </tr>
                <tr>
                    <select class='select-dropdown'>
                        <option value="-1">تحديد نوع السمك</option>
                        <option value="1">بلطي</option>
                        <option value="2">بوري</option>
                        <option value="3">دنيس</option>
                        <option value="4">لوط</option>
                    </select>
                </tr>
                <tr>
                    <select class='select-dropdown'>
                        <option value="-1">تحديد مصدر المياه</option>
                        <option value="1">بحار</option>
                        <option value="2">بحيرات</option>
                        <option value="3">ترع ومصارف</option>
                        <option value="4">مياه جوفية</option>
                        <option value="5">نهر النيل</option>
                    </select>
                </tr>
            </table>

            <table class="index-table" dir="rtl">
                <tr>
                    <select class='select-dropdown'>
                        <option value="-1">تحديد مؤشرات جودة المياه</option>
                    </select>
                </tr>
                <tr>
                    <td class='quality-lbl'>pH</td>
                    <td>
                        <input type="range" min="0" max="100" value="50" class="slider" id="myRange1">
                    </td>

                </tr>
                <tr>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                </tr>
                <tr>
                    <td class='quality-lbl'>Salinity</td>
                    <td>
                        <input type="range" min="0" max="100" value="50" class="slider" id="myRange2">
                    </td>

                </tr>
                <tr>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                </tr>
                <tr>
                <tr>
                    <td class='quality-lbl'>DO</td>
                    <td>
                        <input type="range" min="0" max="100" value="50" class="slider" id="myRange3">
                    </td>

                </tr>
            </table>
            <button class="button" onclick="display_results();">عرض النتائج</button>
        </div>
        <div id="dialog" style="display: none"></div>
        <div id="results_div" class="results">
            <h2 style="padding-right: 40%;">نتائج البحث</h2>
            <!-- <input name="result_checkbox" type="checkbox" onclick="checkbox_status('FinalSuitabilityMapModelReclassify')"
                   id="FinalSuitabilityMapModelReclassify"/><label style="float: left;">Final Suitability Map Model
            Reclassify</label><br/>
            <input name="result_checkbox" type="checkbox" onclick="checkbox_status('FinalSuitabilityMapModel')" id="FinalSuitabilityMapModel"/><label
                style="float: left;">Final Suitability Map Model</label><br/> -->
            <input name="result_checkbox" type="checkbox" onclick="checkbox_status('FinalSuitabilityMapModel')" id="FinalSuitabilityMapModel"/><label
                style="float: left;">Final Suitability Map Model</label><br/>
            <input name="result_checkbox" type="checkbox" onclick="checkbox_status('SoilSubModel')" id="SoilSubModel"/><label
                style="float: left;">Soil Sub-Model</label><br/>
            <input name="result_checkbox" type="checkbox" onclick="checkbox_status('SocioEconomic')" id="SocioEconomic"/><label
                style="float: left;">Socio Economic</label><br/>
            <input name="result_checkbox" type="checkbox" onclick="checkbox_status('WaterAvailabilitySubModel')"
                   id="WaterAvailabilitySubModel"/><label style="float: left;">Water Availability Sub-Model</label><br/>
            <!-- <input name="result_checkbox" type="checkbox" onclick="checkbox_status('FinalRestrictionModel')" id="FinalRestrictionModel"/><label
                style="float: left;">Final Restriction Model</label><br/> -->
            <table id="polyTree">
                <tr>
                    <!--<th>
                        <input name="pol_view_checkbox" type="checkbox" id="pol_view_checkbox"/>
                    </th>-->
                    <th>
                        Polygon Name
                    </th>
                    <th>
                        <button class="btn-action" onclick="convert_csv()" disabled="true"><i class="fa fa-download"></i> CSV</button>
                        {% csrf_token %}
                        <button class="btn-action" onclick="convert_shp()" disabled="true"><i class="fa fa-download"></i> SHP</button>
                    </th>
                </tr>
            </table>
            <button style="padding-right: 15%; float: left; padding-left: 15%;" class="button_return" onclick="hide_results();">رجوع</button>
			<button style="padding-right: 10%; float: right; padding-left: 10%;" class="button_print" onclick="print_report();">طباعة التقرير</button>
        </div>
    </div>
</div>
<script type="text/javascript">
$(document).on({
    ajaxStart: function() { $("body").addClass("loading");},
    ajaxStop: function() { $("body").removeClass("loading");}
});
</script>
<script>
    var polyIndex = 1;
	var polygonCoordinates = "";
	var firstClick = false;
	var temp = "";
	var drawControlCreated = false;
	var zoomInByDraw = false;
	var zoomOutByDraw = false;
	var bounds;
	var mapUrl = 'https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';
	var image;
	var listOfImages = [];
	var listOfLegendImages = [];
    var listOfLegendMinMaxValues = [];
	var data;
	var convertedData;
	var shpdata;

	var left = 0.0;
	var right = 100.0;
	var top = 100.0;
	var bottom = 0.0;
    var name = "";
	var curSelectedLayer = "";
    var clippedImages = [];
    var drawn_polygons_dict = {};
	var polygon_values_list = [];
	var area = 0.0;
	var popupContent = "";
	var url_Egy_L0 = "/static/Extras/Egypt_Boundary.json";
	var url_Egy_L1 = "/static/Extras/Governorates.json";
	var url_Egy_L2 = "/static/Extras/Districts.json";
	var url_Egy_L3 = "/static/Extras/Sub_Districts.json";
	var reb_name = "";
	//var dist_name = "مركز ";
	var satellite = L.tileLayer(mapUrl, {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
			'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox/satellite-v9',
		tileSize: 512,
		zoomOffset: -1
	});

	var streets = L.tileLayer(mapUrl, {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
			'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox/streets-v11',
		tileSize: 512,
		zoomOffset: -1
	});

	var map = L.map('mapid', {
		center: [27.3, 30.8],
		zoom: 6,
		zoomSnap: 0.25,
		layers: [satellite]
	});

	var baseLayers = {
		"Satellite View": satellite,
		"Map View": streets,
	};

    var vectorLayer_L0 = L.geoJson(null, {style: style_L0});
    var vectorLayer_L1 = L.geoJson(null, {onEachFeature: forEachFeature_L1, style: style_L1});
    var vectorLayer_L2 = L.geoJson(null, {onEachFeature: forEachFeature_L2, style: style_L2});

	var editableLayers = new L.FeatureGroup();
	var shapeLayers = new L.FeatureGroup();
	map.addLayer(editableLayers);
	var overlayMaps = {
	"حدود الدولة":vectorLayer_L0,
		"المحافظات":vectorLayer_L1,
		"المراكز":vectorLayer_L2,
		"الطبقات المضافة": editableLayers

	};

    function style_L0(feature) {
	    return {
	        fillColor: '#3592c4',
	        fillOpacity: 0.05,
	        weight: 3,
	        opacity: 0.8,
	        color: '#800000'
	        //dashArray: '3'
	    };
	}

	function style_L1(feature) {
	    return {
	        fillColor: '#3592c4',
	        fillOpacity: 0.05,
	        weight: 2,
	        opacity: 0.8,
	        color: '#3592c4',
	        //dashArray: '3'
	    };
	}

	function style_L2(feature) {
	    return {
	        fillColor: '#3592c4',
	        fillOpacity: 0.0,
	        weight: 1,
	        opacity: 0.7,
	        color: '#111122',
	        dashArray: '3'
	    };
	}
		var highlight = {
			'fillColor': 'yellow',
			'weight': 2,
			'opacity': 1
		};
	//Information window for each Level of layers L1, L2
	var info = L.control();

	info.onAdd = function (map) {
		this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
		this.update();
		return this._div;
	};
	
	function highlightFeature_L1(e) {
		var layer = e.target;

		layer.setStyle({
			weight: 5,
			color: '#0000FF',
			dashArray: '',
			fillOpacity: 0.7
		});

		if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
			layer.bringToFront();
		}
		//info.update(layer.feature.properties);
		info.update = function () {
				reb_name = "محافظة " + layer.feature.properties.ADM1_REF;
				//console.log('1- props: ', props, 'props-name: ', props.ADM1_REF);
				console.log('2- props: ', layer.feature.properties, 'props-name: ', layer.feature.properties.ADM1_REF);
				this._div.innerHTML = '<h4>تفاصيل كل طبقة</h4><br />' +  (layer.feature.properties ?
					'<b>المحافظـــة: ' + layer.feature.properties.ADM1_REF + '</b><br /><br /><b>المســـاحة (كم مربع):' + layer.feature.properties.Area_KM + ' </b>'
					: 'حرك مؤشر الفأرة علي أي منطقة');
			};

			info.addTo(map);
	}
	
	function resetHighlight_L1(e) {
		var layer = e.target;
		//layer.resetStyle(e.target);
		layer.setStyle({
			fillColor: '#3592c4',
	        fillOpacity: 0.05,
	        weight: 2,
	        opacity: 0.8,
	        color: '#3592c4'
		});
		info.update();
		reb_name = "";
		map.removeControl(info);
	}

	function forEachFeature_L1(feature, layer) {
        var lu_name = ""+feature.properties.Name;
        var ADM1_EN = ""+feature.properties.ADM1_REF + ' - ' + layer.name;
        var lu_type = ""+feature.properties.W2020;
        var popupContent = "<div id='t1'><div class='caption'>Feature Properties</div><table><tr><td>ADM1_EN:</td><td>"+ ADM1_EN + "</td></tr><tr><td>B0</td><td>"+ "B1" +
        "</td></tr></table></div><div class='save-btn' onclick='print_lu()' style='cursor: pointer;'>Print</div>";

        var customOptions =
        {
            'maxWidth': '800',
            //'maxHeight': '220',
            'className' : 'custom'
        }
        //layer.bindPopup(popupContent, customOptions);

        layer.on({
				mouseover: highlightFeature_L1,
				mouseout: resetHighlight_L1
			});
    }
	
	function highlightFeature_L2(e) {
		var layer = e.target;

		layer.setStyle({
			fillColor: '#3592c4',
	        fillOpacity: 0.2,
	        weight: 2,
	        opacity: 0.7,
	        color: '#111122',
	        dashArray: '0'
		});

		if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
			layer.bringToFront();
		}
		//info.update(layer.feature.properties);
		info.update = function () {
				//console.log('1- props: ', props, 'props-name: ', props.ADM2_EN);
				reb_name = "مركز " + layer.feature.properties.ADM2_EN;
				console.log('2- props: ', layer.feature.properties, 'props-name: ', layer.feature.properties.ADM2_EN);
				this._div.innerHTML = '<h4>تفاصيل كل طبقة</h4><br />' +  (layer.feature.properties ?
					'<b>المـــركز: ' + layer.feature.properties.ADM2_EN + '</b><br /><br /><b>المســـاحة (كم مربع):' + layer.feature.properties.Area_KM + ' </b>'
					: 'حرك مؤشر الفأرة علي أي منطقة');
			};

			info.addTo(map);
	}
	
	function resetHighlight_L2(e) {
		var layer = e.target;
		//layer.resetStyle(e.target);
		layer.setStyle({
			fillColor: '#3592c4',
	        fillOpacity: 0.0,
	        weight: 1,
	        opacity: 0.7,
	        color: '#111122',
	        dashArray: '3'
		});
		info.update();
		reb_name = "";
		map.removeControl(info);
	}
	
	function forEachFeature_L2(feature, layer) {
        var lu_name = ""+feature.properties.Name;
        var ADM1_EN = ""+feature.properties.ADM1_REF + ' - ' + layer.name;
        var lu_type = ""+feature.properties.W2020;
        var popupContent = "<div id='t1'><div class='caption'>Feature Properties</div><table><tr><td>ADM1_EN:</td><td>"+ ADM1_EN + "</td></tr><tr><td>B0</td><td>"+ "B1" +
        "</td></tr></table></div><div class='save-btn' onclick='print_lu()' style='cursor: pointer;'>Print</div>";

        var customOptions =
        {
            'maxWidth': '800',
            //'maxHeight': '220',
            'className' : 'custom'
        }
        //layer.bindPopup(popupContent, customOptions);

        layer.on({
				mouseover: highlightFeature_L2,
				mouseout: resetHighlight_L2
			});
    }

	var layerControl = L.control.layers(baseLayers, overlayMaps).addTo(map);


	$.getJSON(url_Egy_L0, function(data) {
		vectorLayer_L0.addData(data);
    });

    $.getJSON(url_Egy_L1, function(data) {
		vectorLayer_L1.addData(data);
    });

    $.getJSON(url_Egy_L2, function(data) {
		vectorLayer_L2.addData(data);
    });

    /*$.getJSON(url_Egy_L3, function(data) {
		vectorLayer_L3.addData(data);
    });*/


	var drawPluginOptions = {
	  position: 'topleft',
	  draw: {
		polyline: false,
		polygon: {
		  allowIntersection: false, // Restricts shapes to simple polygons
		  drawError: {
			color: '#e1e100', // Color the shape will turn when intersects
			message: '<strong>Polygon draw does not allow intersections!<strong> (allowIntersection: false)' // Message that will show when intersect
		  },
		  shapeOptions: {
			color: '#ff2222',
            fillOpacity: 0.0,
		  }
		},
		circle: false, // Turns off this drawing tool
		rectangle: false,
		marker: false,
		circlemarker: false
	},
	edit: {
		featureGroup: editableLayers, //REQUIRED!!
		remove: true
	  }};

 var latlng1;
 var latlng2;

map.on('click', function (e) {
	if(zoomInByDraw)
		map.zoomIn(0.25, {animate:false});
	if(zoomOutByDraw)
		map.zoomOut(0.25, {animate:false});
});

function zoomToExtent(){
	map.setView([27.3, 30.8], 6);
}

function zoomOutDraw(){
	zoomOutByDraw = true;
	zoomInByDraw = false;
    L.DomUtil.addClass(map._container,'crosshair-cursor-enabled');
}

function zoomInDraw(){
	zoomOutByDraw = false;
	zoomInByDraw = true;
    L.DomUtil.addClass(map._container,'crosshair-cursor-enabled');
}

function zoomIn(){
    map.zoomIn(1.25);
}

function zoomOut(){
    map.zoomOut(1.25);
}

function showHand(){
    L.DomUtil.removeClass(map._container,'crosshair-cursor-enabled');
	map.dragging.enable();
	zoomOutByDraw = false;
	zoomInByDraw = false;
}

function edit(){
	if(drawControlCreated)
	{
		this.map.removeControl(this.drawControl);
		drawControlCreated = false;
	}

	else{

		drawControl = new L.Control.Draw(drawPluginOptions);
		map.addControl(drawControl);
		map.on(L.Draw.Event.CREATED, function(e) {
		  var type = e.layerType,
			layer = e.layer,
			layerID = layer._leaflet_id;
			var today = new Date();
            var day = today.getDay();
            var date = today.getFullYear()+""+(today.getMonth()+1)+""+today.getDate();
            var time = today.getHours()+""+today.getMinutes()+""+today.getSeconds();
            var dateTime = date+time;
            name = "Poly" + polyIndex + "_" + dateTime;
            polyIndex += 1;
			curSelectedLayer = name;
			layer.on('mouseover', function () {
				  this.setStyle({
					'fillColor': '#0000ff',
					'fillOpacity': 0.5,
				  });
				});
				layer.on('mouseout', function () {
				  this.setStyle({
					'fillColor': '#ff2222',
                    'fillOpacity': 0.0,
				  });
				});
			var tempArray = layer._latlngs[0];
            var all_lat = [];
            var all_lon = [];
		  if (type === 'polygon') {
			polygonCoordinates +="["
			for(var i=0; i<tempArray.length; i++)
			{
			    all_lat.push(tempArray[i].lat);
			    all_lon.push(tempArray[i].lng);
				temp += "[" + tempArray[i].lat+","+tempArray[i].lng + "]";
				if(i === tempArray.length - 1)
					break;
				else
					temp +=",";
			}
			polygonCoordinates +=temp + "]";
		}
			clip_by_polygon(all_lat, all_lon, layer);
			
		  editableLayers.addLayer(layer);
          shapeLayers.addLayer(layer);
		    var buttons = document.getElementsByClassName('btn-action');
		    if(buttons[0].disabled == true)
		    {
		        buttons[0].disabled = false;
		    }
		    if(buttons[1].disabled == true)
		    {
		        buttons[1].disabled = false;
		    }
		    tempArray = null;
			temp = "";
			polygonCoordinates = "";
		});

		map.on(L.Draw.Event.EDITED, function (e) {
				var layers = e.layers;
				var countOfEditedLayers = 0;
				layers.eachLayer(function(layer) {
					countOfEditedLayers++;
				});
			});

		map.on('draw:deleted', function(e){

			tempArray = null;
			temp = "";
			polygonCoordinates = "";
			console.log(tempArray);
			console.log(polygonCoordinates);
		});
		drawControlCreated = true;
	}
}

function getCheckedList()
{
    var checkedList = [];
    var table = document.getElementById("polyTree");
    for (var i = 1, row; row = table.rows[i]; i++) {
       console.log("CheckBox: " + row.cells[1].children[0].checked);
       checkedList[i-1] = row.cells[1].children[0].checked; //Checkbox Element
    }
    return checkedList;
}

function convert_csv()
{
     var num = 0;
     var checkedList = getCheckedList();
     var data = shapeLayers.toGeoJSON();
     var data_str = JSON.stringify(data);
     dataObj = JSON.parse(data_str);
     for(let n=0; n<checkedList.length; n++)
        {
            if(checkedList[n] == true)
            {
                num = num + 1;
            }
        }
     if(num == 0)
     {
        alert("Please select at least file to download");
     }
     else
     {
        str_coords = "ID,Polygon Name,Area KM^2,Area Feddan,Centroid Lat, Centroid Lon," + polygon_values_list[0] + "_mean,"+ polygon_values_list[4] + "_mean,"+ polygon_values_list[8] + "_mean,"+ polygon_values_list[12] + "_mean\n";
         for(let i=0; i<dataObj.features.length; i++){
            if(checkedList[i]){
				str_coords += (i+1) + ',';
                str_coords +=  dataObj.features[i].properties.name + ',';
                str_coords += dataObj.features[i].properties.area_km+ ',';
                str_coords += dataObj.features[i].properties.area_fd+ ',';
                str_coords += dataObj.features[i].properties.cen_lat+ ',';
                str_coords += dataObj.features[i].properties.cen_lon+ ',';
				str_coords += dataObj.features[i].properties[polygon_values_list[0] + "_mean"]+ ',';
				str_coords += dataObj.features[i].properties[polygon_values_list[4] + "_mean"]+ ',';
				str_coords += dataObj.features[i].properties[polygon_values_list[8] + "_mean"]+ ',';
				str_coords += dataObj.features[i].properties[polygon_values_list[12] + "_mean"]+ '\n';

			}
         }
         console.log(str_coords);

         convertedData = 'data:text/csv;charset=utf-8,' + encodeURI(str_coords);
          // Create export
          document.getElementById('export_csv').setAttribute('href', convertedData);
          document.getElementById('export_csv').setAttribute('download', 'Polygons Coordinates.csv');
          document.getElementById('export_csv').click();
     }
}

function convert_shp()
{
    var num = 0;
    var csrftoken = $("[name=csrfmiddlewaretoken]").val();
	
	var checkedList = getCheckedList();
    var data = shapeLayers.toGeoJSON();
	var data_str = JSON.stringify(data);
    var dataObj = JSON.parse(data_str);
    for(let n=0; n<checkedList.length; n++)
    {
        if(checkedList[n] == true)
        {
            num = num + 1;
        }
    }
    if(num == 0)
    {
        alert("Please select at least 1 file to download");
    }
    else
    {
        for(let i=0; i<dataObj.features.length; i++)
        {
            if(!checkedList[i])
            {
                delete dataObj.features[i];
            }
        }
        data_str_after = JSON.stringify(dataObj);
        $.ajax({
          type: "POST",
          url: "{% url 'download_shapefile' %}",
		  headers:{
			  "X-CSRFToken": csrftoken
		  },
          data: {
            'geoJson': data_str_after
          },
          success:function (res){
            console.log(res);
            var download_link = 'http://127.0.0.1:8000/static/drawn_layers/'+res;
            document.getElementById('export_shp').setAttribute('href', download_link);
            document.getElementById('export_shp').click();
          },
          error: function (response) {
             // alert the error if any error occured
             console.log("Ajax Request Error");
             console.log(response);
          }
        });
    }
}

function checkbox_status(id){
	var selected_checkbox = document.getElementById(id);
	if (selected_checkbox.checked != true){
    	remove_results(id)
	} else{
		load_results(id);
		load_legend_img(id);
	}
}

function load_results(id){
    var top_eg = 31.5788540066
    var left_eg = 30.0000142271
    var right_eg = 32.0100142271
    var bottom_eg = 30.6618540066

    // Extent for South Africa Data
    /*
    var top_sa = -22.137060
    var left_sa = 31.788092
    var right_sa = 26.406370
    var bottom_sa = -25.436225
    */

    var imageUrl = 'http://127.0.0.1:8000/static/Model_Data/outputs/Egypt/'+id+'.png';
    //var imageBounds = [[-22.137060, 26.406370], [-25.436225, 31.788092]]; // for south africa data
    var imageBounds = [[top_eg, right_eg], [bottom_eg, left_eg]];
	image = L.imageOverlay(imageUrl, imageBounds);
	image.addTo(map);
	image.bringToFront();
	//map.setView(new L.LatLng(-23.475295543475283,29.17847128786904), 8); // for south africa data
	map.setView(new L.LatLng(31.047621381135954, 31.09472389830886), 9);
	listOfImages.push(image);
}

function remove_results(id){
	var checkedURL = 'http://127.0.0.1:8000/static/Model_Data/outputs/Egypt/'+id+'.png';
	listOfImages.forEach(function(entry) {
    	if(checkedURL === entry["_url"]){
    		map.removeLayer(entry);
    		var index = listOfImages.indexOf(entry);
    		if (index > -1) {
    			listOfImages.splice(index, 1);
    		}
    	}
	});
	remove_legend_img(id);
    remove_legend_minmaxvalues(id);
}

function load_legend_img(id){
    document.getElementById("legend_img_src").src = 'http://127.0.0.1:8000/static/Model_Data/outputs/Egypt/'+id+'_legend.jpg';
    listOfLegendImages.push(id);
    document.getElementById("legend_min_max_div").innerHTML = read_min_max_files('http://127.0.0.1:8000/static/Model_Data/outputs/Egypt/'+id+'.tif.txt');
    listOfLegendMinMaxValues.push(id);
}

function remove_legend_img(id){
	listOfLegendImages.forEach(function(entry) {
    	if(id === entry){
    		var index = listOfLegendImages.indexOf(entry);
    		if (index > -1) {
    			listOfLegendImages.splice(index, 1);
    		}
    	}
	});
    if (listOfLegendImages.length === 0) {
        document.getElementById("legend_img_src").src = '';   
    }else{
        document.getElementById("legend_img_src").src = 'http://127.0.0.1:8000/static/Model_Data/outputs/Egypt/'+listOfLegendImages.at(-1)+'_legend.jpg';   
    }
}

function remove_legend_minmaxvalues(id){
    listOfLegendMinMaxValues.forEach(function(entry) {
    	if(id === entry){
    		var index = listOfLegendMinMaxValues.indexOf(entry);
    		if (index > -1) {
    			listOfLegendMinMaxValues.splice(index, 1);
    		}
    	}
	});
    if (listOfLegendMinMaxValues.length === 0) {
        document.getElementById("legend_min_max_div").innerHTML = '';
    }else{
        document.getElementById("legend_min_max_div").innerHTML = read_min_max_files('http://127.0.0.1:8000/static/Model_Data/outputs/Egypt/'+listOfLegendMinMaxValues.at(-1)+'.tif.txt');
    }
}

function display_results(){
	document.getElementById("results_div").style.display = 'block';
	document.getElementById("legend_div").style.display = 'block';
    document.getElementById("legend_min_max_div").style.display = 'block';
	document.getElementById("parameters_div").style.display = 'none';
	//map.setView(new L.LatLng(-23.475295543475283,29.17847128786904), 8); //for South Africa
	map.setView(new L.LatLng(31.047621381135954, 31.09472389830886), 9);
}

function hide_results(){
	document.getElementById("results_div").style.display = 'none';
	document.getElementById("legend_div").style.display = 'none';
    document.getElementById("legend_min_max_div").style.display = 'none';
	document.getElementById("parameters_div").style.display = 'block';

	var result_checkboxes = document.getElementsByName('result_checkbox');
    for (var checkbox of result_checkboxes) {
        checkbox.checked = false;
    }

    listOfImages.forEach(function(entry) {
    	map.removeLayer(entry);
	});

	document.getElementById("legend_img_src").src="";
    document.getElementById("legend_min_max_div").innerHTML="";

    listOfLegendImages=[];
    listOfLegendMinMaxValues=[];
    listOfImages=[];

	map.setView([27.3, 30.8], 6);
}
var win = null;
//var ctx = null;

function print_report(){
	//alert("I am a Report...");
	var color1 = '#203239';
    var color2 = '#E0DDAA'; //'#ed6';
	var today = new Date();
	var day = today.getDay();
	var daylist = ["Sunday","Monday","Tuesday","Wednesday ","Thursday","Friday","Saturday"];
	var date = today.getDate()+'-'+(today.getMonth()+1)+'-'+today.getFullYear();
	var time = today.getHours() + ":" + today.getMinutes();
	var dateTime = date+' '+time;
	//var t1 = document.getElementById('t1').innerHTML;
	var style = "<style>";
	style = style + ".header{padding: 0; font-size: 20px; font-weight: bold; line-height: 20px; text-align: right;    background: white;}";
	style = style + ".col_header1{float: left; width: 15%; padding: 0; height: 100px; border: 0px solid black;}";
	//style = style + ".col_header2{float: left; width: 58%; padding: 0; height: 100px; border: 1px solid black;}";
	style = style + ".col_header3{float: left; width: 65%; padding: 0 10px; height: 100px; border: 0px solid black; text-align: center;}";
	style = style + ".col_header4{float: left; width: 15%; padding: 0; height: 100px; border: 0px solid black;}";
	style = style + ".main {height: calc(100% - 102px);}";
	style = style + "</style>";
	
	var script_content = "<script>"
	+ "function loadGraph(){"
	+ "const ctx = win.document.getElementById('line-chart').getContext('2d');"
	+ "const vlabels = ['Final Suitability Model Mean','Soil SubModel Mean','Socio Economic Mean','Water Availability SubModel Mean'];"
	+ "const barColors = ['rgba(255, 99, 132, 0.2)', 'rgba(255, 159, 64, 0.2)', 'rgba(255, 205, 86, 0.2)', 'rgba(75, 192, 192, 0.2)'];"
	+ "const borderColors = ['rgb(255, 99, 132)', 'rgb(255, 159, 64)', 'rgb(255, 205, 86)', 'rgb(75, 192, 192)'];"
	+ "const data = {labels: vlabels, datasets: [{label: 'My First Dataset', data: [77, 73, 26, 24], 		  backgroundColor: barColors, borderColor: borderColors, borderWidth: 1, }]};"
	+ "const config = {type: 'bar', data: data, options: {legend: {display: false}, title: {display: true, text: 'Final Model Mean Values'}, scales: { y: { beginAtZero: true }}},};"
	+ "const pivotChart = new Chart(ctx, config);"
	+ "}"
	+ "<//script>";
	
	var content = "<!DOCTYPE html>"
		+ "<html><head>"
		+ "<title>GAFRD Report</title>"
		+ "{% load static %}"
		+ "<script src='{% static "js/chart.js"%}'><\/script>"
		+ "<script src='{% static "js/load_report_graph.js"%}'><\/script>"
		+ style
		+ "</head>"
		+ "<body onload='loadGraph()'><div class='header'><div class='row'><img class='col_header1' src='{% static "img/h_img1.png" %}'/>"
		+ "<div class='col_header3'><p>جمهورية مصر العربية</p><p>الهيئة العامة لتنمية الثروة السمكية</p></div>"
		+ "<img class='col_header4' src='{% static "img/h_img3.png" %}'/></div></div>"
		+ "<br><br><br><br><div style='width: 100%; text-align: center; padding-top: 15px; padding-bottom: 15px; font-weight: bold; font-size: 18px; border: 1px solid black; direction: rtl; margin-top: 50px; background-color: #3592c4; color: white'>تقرير تفصيلي عن : "
		+ "</div><br><br>"
		+ "<div class='row main'>"
		+ "<div style='width: 100%; border: 1px solid black;'>"
		+ "<table align='center' dir='rtl' width='100%'>"
		+ "<tr width='50%'><td><img style='width:100%;height:200px;' src="+listOfImages[0]['_url']+"/></td>"
		+ "<td><img style='width:100%;height:200px;' src="+listOfImages[1]['_url']+"/></td></tr>"
		+ "<tr width='50%'><td><img style='width:100%;height:200px;' src="+listOfImages[2]['_url']+"/></td>"
		+ "<td><img style='width:100%;height:200px;' src="+listOfImages[3]['_url']+"/></td></tr>"
		+ "</table></div>"
		+ "<br><br><div style='width: 100%; border: 1px solid black;'>"
		+ "<table align='center' dir='ltr' width='100%' style='border: 1px solid black;'>"
		+ "<tr width='100%' style='border: 1px solid black;'>"
		+ "<th style='border: 1px solid black; background-color: #3592c4; color: white;'>Final Suitability Model Mean</th>"
		+ "<th style='border: 1px solid black; background-color: #3592c4; color: white;'>Soil SubModel Mean</th>"
		+ "<th style='border: 1px solid black; background-color: #3592c4; color: white;'>Socio Economic Mean</th>"
		+ "<th style='border: 1px solid black; background-color: #3592c4; color: white;'>Water Availability SubModel Mean</th>"
		+ "</tr>"
		+ "<tr width='100%' style='border: 1px solid black;'>"
		+ "<td style='text-align: center; border: 1px solid black;'>77.218925</td>"
		+ "<td style='text-align: center; border: 1px solid black;'>3.6513283</td>"
		+ "<td style='text-align: center; border: 1px solid black;'>26.002209</td>"
		+ "<td style='text-align: center; border: 1px solid black;'>24.98878</td>"
		+ "</tr></table></div>"
		+ script_content
		+ "</div></body></html>";
		

	// CREATE A WINDOW OBJECT.
	win = window.open('', '_blank', 'height=600,width=800');
	win.document.write(content);
	/*win.document.write('<!DOCTYPE html>');
	win.document.write('<html><head>');
	win.document.write('<title>GAFRD Report</title>');   // <title> FOR PDF HEADER.
	win.document.write("{% load static %}");
	win.document.write("<script src='{% static "js/chart.js"%}'><\/script>");
	win.document.write("<script src='{% static "js/load_report_graph.js"%}'><\/script>");
	win.document.write('<script type="text/javascript" src="{% static 'js/chart.js' %}"><\/script>');
	win.document.write('<script type="text/javascript" src="{% static 'js/load_report_graph.js' %}"><\/script>');
	win.document.write(style);          // ADD STYLE INSIDE THE HEAD TAG.
	win.document.write('</head>');
	win.document.write('<body><div class="header"><div class="row">{% load static %}<img class="col_header1" src="{% static 'img/h_img1.png' %}">');
	win.document.write('<div class="col_header3"><p>جمهورية مصر العربية</p><p>الهيئة العامة لتنمية الثروة السمكية</p></div>');
	win.document.write('<img class="col_header4" src="{% static 'img/h_img3.png' %}"></div></div>');
	win.document.write('<br><br><br><br><div style="width: 100%; text-align: center; padding-top: 15px; padding-bottom: 15px; font-weight: bold; font-size: 18px; border: 1px solid black; direction: rtl; margin-top: 50px; background-color: #3592c4; color: white">تقرير تفصيلي عن : ');
	win.document.write(reb_name);
	win.document.write('</div><br><br>');
	win.document.write('<div class="row main">');
	win.document.write('<div style="width: 100%; border: 1px solid black;">');
	win.document.write('<table align="center" dir="rtl" width="100%">');
	win.document.write('<tr width="50%">');
	win.document.write('<td>');
	win.document.write('<img style="width:100%;height:200px;" src='+listOfImages[0]["_url"]+'>');
	win.document.write('</td>');
	win.document.write('<td width="50%">');
	win.document.write('<img style="width:100%;height:200px;" src='+listOfImages[1]["_url"]+'>');
	win.document.write('</td>');
	win.document.write('</tr>');
	win.document.write('<tr>');
	win.document.write('<td width="50%">');
	win.document.write('<img style="width:100%;height:200px;" src='+listOfImages[2]["_url"]+'>');
	win.document.write('</td>');
	win.document.write('<td width="50%">');
	win.document.write('<img style="width:100%;height:200px;" src='+listOfImages[3]["_url"]+'>');
	win.document.write('</td>');
	win.document.write('</tr>');
	win.document.write('</table>');
	win.document.write('</div>');
	win.document.write('<br><br><div style="width: 100%; border: 1px solid black;">');
	win.document.write('<table align="center" dir="ltr" width="100%" style="border: 1px solid black;">');
	win.document.write('<tr width="100%" style="border: 1px solid black;">');
	win.document.write('<th style="border: 1px solid black; background-color: #3592c4; color: white;">Final Suitability Model Mean</th>');
	win.document.write('<th style="border: 1px solid black; background-color: #3592c4; color: white;">Soil SubModel Mean</th>');
	win.document.write('<th style="border: 1px solid black; background-color: #3592c4; color: white;">Socio Economic Mean</th>');
	win.document.write('<th style="border: 1px solid black; background-color: #3592c4; color: white;">Water Availability SubModel Mean</th>');
	win.document.write('</tr>');
	win.document.write('<tr width="100%" style="border: 1px solid black;">');
	win.document.write('<td style="text-align: center; border: 1px solid black;">77.218925</td>');
	win.document.write('<td style="text-align: center; border: 1px solid black;">3.6513283</td>');
	win.document.write('<td style="text-align: center; border: 1px solid black;">26.002209</td>');
	win.document.write('<td style="text-align: center; border: 1px solid black;">24.98878</td>');
	win.document.write('</tr>');
	win.document.write('</table>');
	win.document.write('</div>');
	win.document.write('<br><div style="width: 100%; border: 1px solid black;">');
	win.document.write('<div id="chart-container">');
	win.document.write('<canvas id="line-chart" style="width:100%; height: 200px;"></canvas></div>');
	win.document.write('</div></div>');
	win.document.write('</body></html>');*/
	//ctx = win.document.getElementById("line-chart").getContext("2d");
	//alert("ctx: " + ctx);
	//win.document.onload= loadGraph();
	//win.document.close(); 	// CLOSE THE CURRENT WINDOW.
	
	win.print();    // PRINT THE CONTENTS.
	
}

window.onload=hide_results();

function clip_by_polygon(cl_all_lat, cl_all_lon, cur_layer)
{
    var csrftoken = $("[name=csrfmiddlewaretoken]").val();
	$.ajax({
          type: "POST",
          url: "{% url 'run_clip_polygon' %}",
		  headers:{
			  "X-CSRFToken": csrftoken
		  },
          data: {
			'polygonCoordinates': polygonCoordinates,
            'name': name
          },
		  success: function (res) {
            polygon_values_list = res.split(",");
            for(let x = 0; x < polygon_values_list.length; x++){
                if(x % 4 != 0){
                    polygon_values_list[x] = parseFloat(polygon_values_list[x]);
                }
            }
			clippedImageUrl = 'http://127.0.0.1:8000/static/polygons/'+name+"_"+polygon_values_list[0]+'.png';
            clippedImageBounds = [[Math.max.apply(null,cl_all_lat), Math.min.apply(null, cl_all_lon)], [Math.min.apply(null, cl_all_lat), Math.max.apply(null, cl_all_lon)]];
            var clippedImage = L.imageOverlay(clippedImageUrl, clippedImageBounds);
            drawn_polygons_dict[name] = [cl_all_lat, cl_all_lon, clippedImage];
            clippedImages.push(name);

            area = L.GeometryUtil.geodesicArea(cur_layer._latlngs[0]);
			const reducer = (accumulator, curr) => accumulator + curr;
			var cen_lat = cl_all_lat.reduce(reducer) / cl_all_lat.length;
			var cen_lon = cl_all_lon.reduce(reducer) / cl_all_lon.length;

			var feature = cur_layer.feature = cur_layer.feature || {}; // Initialize feature
			feature.type = feature.type || "Feature"; // Initialize feature.type
			var props = feature.properties = feature.properties || {}; // Initialize feature.properties
			props.name = name;
			props.area_km = area / 1000000.0;
			props.area_fd = area / 4200.0;
			props.cen_lat = cen_lat;
			props.cen_lon = cen_lon;

			props[polygon_values_list[0] + "_min"] = polygon_values_list[1];
			props[polygon_values_list[0] + "_max"] = polygon_values_list[2];
			props[polygon_values_list[0] + "_mean"] = polygon_values_list[3];
			props[polygon_values_list[4] + "_min"] = polygon_values_list[5];
			props[polygon_values_list[4] + "_max"] = polygon_values_list[6];
			props[polygon_values_list[4] + "_mean"] = polygon_values_list[7];
			props[polygon_values_list[8] + "_min"] = polygon_values_list[9];
			props[polygon_values_list[8] + "_max"] = polygon_values_list[10];
			props[polygon_values_list[8] + "_mean"] = polygon_values_list[11];
			props[polygon_values_list[12] + "_min"] = polygon_values_list[13];
			props[polygon_values_list[12] + "_max"] = polygon_values_list[14];
			props[polygon_values_list[12] + "_mean"] = polygon_values_list[15];

            popupContent = build_popup(props, polygon_values_list);
            //cur_layer.bindPopup(myPopup, {maxWidth: "auto"});
            cur_layer.bindPopup(popupContent, {maxHeight: 300, maxWidth: "auto"});

            //Create Table Contents
            const tr = document.createElement('tr');
            const td = document.createElement('td');
            const td_checkbox = document.createElement('td');
            const checkbox = document.createElement("INPUT");
            checkbox.setAttribute("type", "checkbox");
            checkbox.setAttribute("name", name);
            checkbox.setAttribute("id", name);
            checkbox.setAttribute("onclick","show_hide_polygon(this.name)");
            checkbox.style.textAlign = "center";

            const text = document.createTextNode(name);
            td.appendChild(text);
            tr.appendChild(td);

            td_checkbox.appendChild(checkbox);
            tr.appendChild(td_checkbox);

            document.getElementById('polyTree').appendChild(tr);
          },
          error: function (response) {
             // alert the error if any error occured
             console.log("Ajax Request Error");
             console.log(response);
          }
        });
}

function show_hide_polygon(x)
{
    var chk_box = document.getElementById(x);
    if(chk_box.checked == false)
        remove_clipped_image(chk_box.name);
    else
        add_clipped_image(chk_box.name);
}

function remove_clipped_image(id)
{
    map.removeLayer(drawn_polygons_dict[id][2]);
}

function add_clipped_image(id)
{
    
    drawn_polygons_dict[id][2].addTo(map);
    clippedImages.push(id);
}

function build_popup(props, values_list){
    var popup_content = "<table style='width:100%;'>"+
                "<tr><td colspan='2'><div class='popup-title'>"+props.name+"</div></td></tr>"+
                "<tr><td colspan='2'><div class='popup-subtitle'>Basic Information</div></td></tr>"+
                "<tr style='width:100%;'><td class='popup-key'>Area (KM^2)</td><td class='popup-val'>: "+(Math.round((props.area_km + Number.EPSILON) * 1000) / 1000)+"</td></tr>"+
                "<tr style='width:100%;'><td class='popup-key'>Centroid Lat</td><td class='popup-val'>: "+(Math.round((props.cen_lat + Number.EPSILON) * 100000) / 100000)+"</td></tr>"+
                "<tr style='width:100%;'><td class='popup-key'>Centroid Lon</td><td class='popup-val'>: "+(Math.round((props.cen_lon + Number.EPSILON) * 100000) / 100000)+"</td></tr>"+
                "</table><table>"+
                "<tr><td colspan='2'><div class='popup-subtitle'>Mean of Model Outputs</div></td></tr>"+
                "<tr style='width:100%;'><td class='popup-key'>FinalSuitabilityModel</td><td class='popup-val'>: "+(Math.round((values_list[3] + Number.EPSILON) * 100) / 100)+"</td></tr>"+
                "<tr style='width:100%;'><td class='popup-key'>SoilSubModel</td><td class='popup-val'>: "+(Math.round((values_list[7] + Number.EPSILON) * 100) / 100)+"</td></tr>"+
                "<tr style='width:100%;'><td class='popup-key'>SocioEconomic</td><td class='popup-val'>: "+(Math.round((values_list[11] + Number.EPSILON) * 100) / 100)+"</td></tr>"+
                "<tr style='width:100%;'><td class='popup-key'>WaterAvailabilitySubModel</td><td class='popup-val'>: "+(Math.round((values_list[15] + Number.EPSILON) * 100) / 100)+"</td></tr>"+
                "<tr><td colspan='2'><div class='popup-subtitle'>Polygon Thumbnail</div></td></tr>"+
                "<tr><td colspan='2'><div class=''><img width='200px' height='150px' src='../static/polygons/"+props.name+"_FinalSuitabilityMapModel.png'></div></td></tr>"+
                "</table>";
    return popup_content;
}

function read_min_max_files(file)
{
    var legend_min_max_values;
    var rawFile = new XMLHttpRequest();
    rawFile.open("GET", file, false);
    rawFile.onreadystatechange = function ()
    {
        if(rawFile.readyState === 4)
        {
            if(rawFile.status === 200 || rawFile.status == 0)
            {
                var allText = rawFile.responseText;
                const minMaxValue = allText.split(/\r?\n/);
                legend_min_max_values = "<p style='float: left; background-color: rgb(0,0,0, 0.5);'>"+minMaxValue[0]+"</p><p style='float: right; background-color: rgb(0,0,0, 0.5);'>"+minMaxValue[1]+"</p>"
            }
        }
    }
    rawFile.send(null);
    return legend_min_max_values;
}

var toggler = document.getElementsByClassName("caret");
var i;

for (i = 0; i < toggler.length; i++) {
  toggler[i].addEventListener("click", function() {
    this.parentElement.querySelector(".nested").classList.toggle("active");
    this.classList.toggle("caret-down");
  });
}

/*function loadGraph()
{
	const ctx = win.document.getElementById("line-chart").getContext("2d");
	const vlabels = ['Final Suitability Model Mean','Soil SubModel Mean','Socio Economic Mean','Water Availability SubModel Mean'];
	
	const barColors = [
		  'rgba(255, 99, 132, 0.2)',
		  'rgba(255, 159, 64, 0.2)',
		  'rgba(255, 205, 86, 0.2)',
		  'rgba(75, 192, 192, 0.2)'
		];
		
	const borderColors = [
		  'rgb(255, 99, 132)',
		  'rgb(255, 159, 64)',
		  'rgb(255, 205, 86)',
		  'rgb(75, 192, 192)'
		];
		
	const data = {
		labels: vlabels,
		datasets: [{
		  label: 'My First Dataset',
		  data: [77, 73, 26, 24],
		  backgroundColor: barColors,
		  borderColor: borderColors,
		  borderWidth: 1,
		}]
	};

	const config = {
	  type: 'bar',
	  data: data,
	  options: {
		legend: {display: false},
		title: {
		  display: true,
		  text: "Final Model Mean Values"
		},
		scales: {
		  y: {
			beginAtZero: true
		  }
		}
	  },
	};

	const pivotChart = new Chart(ctx, config);
	console.log("pivotChart", pivotChart);
}*/
</script>
<div class="modal2"><h3>Please Wait, Loading...</h3>
</div>
{% csrf_token %}
<a id="clip_by_polygon" ></a>
<a id="export_shp"></a>
<a id="export_csv"></a>
</body>
</html>